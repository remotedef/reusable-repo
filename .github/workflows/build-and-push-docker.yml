# .github/workflows/call-build-and-push.yml
name: Call Build and Push Docker Image

on:
  push:
    branches:
      - main  # Trigger when pushing to the main branch

jobs:
  call-reusable-workflow:
    runs-on: ubuntu-latest
    environment: production  # Optional, to specify an environment

    steps:
      - name: Set up Google Cloud Credentials as Environment Variable
        run: echo "GCP_CREDENTIALS=${{ secrets.GCP_CREDENTIALS }}" >> $GITHUB_ENV  # Set secret as environment variable

      - name: Checkout Repository
        uses: actions/checkout@v2

      - name: Call Reusable Workflow from Another Repo
        uses: username/other-repo/.github/workflows/build-and-push-docker.yml@main  # Reference the remote workflow
        with:
          docker_image_name: 'my-app'  # Docker image name
          docker_tag: 'latest'  # Docker image tag
          gcp_project_id: 'your-gcp-project-id'  # Your GCP Project ID
          gcp_region: 'us-central1'  # The region where your Artifact Registry is located
        env:
          GCP_CREDENTIALS: ${{ secrets.GCP_CREDENTIALS }}  # Pass the secret as environment variable
